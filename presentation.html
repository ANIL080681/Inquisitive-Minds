<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homework Assistant - Presentation</title>
  <style>
    :root {
      --bg-primary: #1a1a2e;
      --bg-gradient-start: #667eea;
      --bg-gradient-end: #764ba2;
      --text-primary: #fff;
      --text-secondary: rgba(255, 255, 255, 0.8);
      --card-bg: rgba(255, 255, 255, 0.15);
      --card-border: rgba(255, 255, 255, 0.3);
    }

    body.light-mode {
      --bg-primary: #f5f5f5;
      --bg-gradient-start: #a8c0ff;
      --bg-gradient-end: #3f2b96;
      --text-primary: #333;
      --text-secondary: #666;
      --card-bg: rgba(255, 255, 255, 0.9);
      --card-border: rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
      transition: background 0.3s, color 0.3s;
    }

    .slide {
      display: none;
      width: 100vw;
      height: 100vh;
      padding: 60px;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      align-items: center;
      justify-content: flex-start;
      flex-direction: column;
      text-align: center;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
    }

    .slide.active {
      display: flex;
    }

    h1 {
      font-size: 4em;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    h2 {
      font-size: 2.5em;
      margin-bottom: 20px;
      color: var(--text-primary);
    }

    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.5);
      color: var(--text-primary);
      border-radius: 30px;
      cursor: pointer;
      font-size: 1.2em;
      backdrop-filter: blur(10px);
      transition: all 0.3s;
    }

    .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }

    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .loading-overlay.active {
      display: flex;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 6px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .loading-text {
      margin-top: 20px;
      font-size: 1.4em;
      color: #fff;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    h3 {
      font-size: 2em;
      margin-bottom: 15px;
      color: #f0f0f0;
    }

    p, li {
      font-size: 1.5em;
      line-height: 1.6;
      max-width: 900px;
      margin: 0 auto 20px;
    }

    .author-info {
      margin-top: 40px;
      padding: 30px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .author-info p {
      margin: 10px 0;
      font-size: 1.3em;
    }

    .emoji {
      font-size: 1.5em;
      margin-right: 10px;
    }

    .controls {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      gap: 15px;
      z-index: 1000;
    }

    button {
      padding: 15px 30px;
      font-size: 1.2em;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid white;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      backdrop-filter: blur(10px);
      transition: all 0.3s;
    }

    button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .slide-number {
      position: fixed;
      bottom: 30px;
      left: 30px;
      font-size: 1.2em;
      color: white;
      background: rgba(0, 0, 0, 0.3);
      padding: 10px 20px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
    }

    .progress-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: rgba(0, 0, 0, 0.3);
      z-index: 1000;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.4s ease;
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.8);
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-top: 30px;
      max-width: 1200px;
    }

    .feature-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
      transition: transform 0.3s;
    }

    .feature-card:hover {
      transform: translateY(-5px);
    }

    ul {
      text-align: left;
      max-width: 800px;
      margin: 20px auto;
    }

    li {
      margin: 15px 0;
      list-style-position: inside;
    }

    .signin-form-demo {
      background: rgba(255, 255, 255, 0.15);
      padding: 40px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      max-width: 500px;
      margin: 30px auto;
    }

    .form-field {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-field label {
      display: block;
      font-size: 1.2em;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .form-field input {
      width: 100%;
      padding: 15px;
      font-size: 1.1em;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      backdrop-filter: blur(5px);
    }

    .form-field input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .demo-button {
      width: 100%;
      margin-top: 20px;
      padding: 18px;
      font-size: 1.3em;
      background: rgba(255, 255, 255, 0.3);
      border: 2px solid white;
      color: white;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    .demo-button:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: scale(1.02);
    }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text">ğŸ§  AI is thinking...</div>
  </div>

  <!-- Slide 1: Homepage -->
  <div class="slide active">
    <h1>ğŸ“š Homework Assistant</h1>
    <h2>Your AI-Powered Study Companion</h2>
    <p>An intelligent homework helper that solves Math, English, and Science problems with detailed explanations</p>
    
    <div class="author-info">
      <h3>Created By</h3>
      <p><span class="emoji">ğŸ‘¤</span><strong>Author:</strong> Nimit</p>
    </div>
    
    <div style="margin-top: 40px; padding: 25px; background: rgba(255, 255, 255, 0.15); border-radius: 15px; backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.3);">
      <h3 style="font-size: 2em; margin-bottom: 10px;">ğŸ’° Only RM15</h3>
      <p style="font-size: 1.3em;">Get unlimited access to all subjects and features</p>
    </div>
    
    <div style="margin-top: 30px; padding: 20px; background: rgba(100, 255, 100, 0.2); border-radius: 12px; border: 2px solid rgba(150, 255, 150, 0.5); max-width: 800px;">
      <h3 style="font-size: 1.5em; margin-bottom: 12px;">ğŸ¤– AI-Powered</h3>
      <p style="font-size: 1em; text-align: left; line-height: 1.6;">
        <strong>âœ¨ Now with Google Gemini AI:</strong><br>
        âœ… Complex word problems & multi-step reasoning<br>
        âœ… Essay writing help & creative compositions<br>
        âœ… Reading comprehension & analysis<br>
        âœ… Advanced math (algebra, geometry, calculus prep)<br>
        âœ… Science experiments & lab questions<br>
        âœ… Detailed step-by-step explanations<br>
        <br>
        <strong>ğŸ’¡ Smart system:</strong> Uses pattern matching first (instant), falls back to AI for complex problems
      </p>
    </div>
    
    <div style="margin-top: 30px; padding: 25px; background: rgba(255, 215, 0, 0.15); border-radius: 15px; backdrop-filter: blur(10px); border: 2px solid rgba(255, 215, 0, 0.4); max-width: 600px;">
      <h3 style="font-size: 1.8em; margin-bottom: 15px;">ğŸ† Global Leaderboard</h3>
      <div style="text-align: left; font-size: 1.1em; line-height: 2.2;">
        <div style="display: flex; justify-content: space-between; padding: 8px 15px; background: rgba(255, 215, 0, 0.3); border-radius: 8px; margin-bottom: 10px;">
          <span>ğŸ¥‡ <strong>Alex Chen</strong></span>
          <span><strong>2,847 pts</strong></span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 8px 15px; background: rgba(192, 192, 192, 0.3); border-radius: 8px; margin-bottom: 10px;">
          <span>ğŸ¥ˆ <strong>Sarah Kim</strong></span>
          <span><strong>2,103 pts</strong></span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 8px 15px; background: rgba(205, 127, 50, 0.3); border-radius: 8px; margin-bottom: 10px;">
          <span>ğŸ¥‰ <strong>Marcus Lee</strong></span>
          <span><strong>1,856 pts</strong></span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 8px 15px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 10px;">
          <span>4ï¸âƒ£ <strong>Emma Wong</strong></span>
          <span><strong>1,542 pts</strong></span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 8px 15px; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
          <span>5ï¸âƒ£ <strong>David Tan</strong></span>
          <span><strong>1,298 pts</strong></span>
        </div>
      </div>
      <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;">ğŸ’ª Compete with students worldwide!</p>
    </div>
  </div>

  <!-- Slide 2: Sign In Page -->
  <div class="slide">
    <h1>ğŸ” Sign In / Sign Up</h1>
    <h2>Create Your Account</h2>
    
    <div class="signin-form-demo">
      <div class="form-field">
        <label>ğŸ“§ Email</label>
        <input type="email" placeholder="student@example.com" onkeypress="if(event.key==='Enter') handleSignUp()">
      </div>
      
      <div class="form-field">
        <label>ğŸ”’ Password</label>
        <div style="position: relative;">
          <input id="password-field" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="padding-right: 50px;" onkeypress="if(event.key==='Enter') handleSignUp()">
          <span onclick="togglePassword()" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 1.3em; user-select: none;">ğŸ‘ï¸</span>
        </div>
      </div>
      
      <div class="form-field">
        <label>ğŸ‚ Date of Birth</label>
        <input type="date" value="2015-01-15" onkeypress="if(event.key==='Enter') handleSignUp()">
      </div>
      
      <div class="form-field">
        <label>ğŸ“š Class/Grade</label>
        <input type="text" placeholder="Grade 5" onkeypress="if(event.key==='Enter') handleSignUp()">
      </div>
      
      <div class="form-field">
        <label>ğŸ« School Name</label>
        <input type="text" placeholder="Springfield Elementary" onkeypress="if(event.key==='Enter') handleSignUp()">
      </div>
      
      <button class="demo-button" onclick="handleSignUp()">Sign Up ğŸš€</button>
    </div>
    
    <p style="margin-top: 30px; font-size: 1.2em;">âœ“ Age verification for safety (5+ years old)</p>
  </div>

  <!-- Slide 3: Ask Questions -->
  <div class="slide">
    <h1>â“ Ask Your Questions</h1>
    <h2>Get Help with Any Subject</h2>
    
    <div id="motivational-quote" style="margin-bottom: 20px; padding: 20px 30px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 140, 0, 0.15) 100%); border-radius: 15px; border-left: 4px solid gold; max-width: 900px;">
      <div style="font-size: 1.8em; margin-bottom: 8px;">ğŸ’­</div>
      <p id="quote-text" style="font-size: 1.2em; font-style: italic; margin-bottom: 8px; color: #fff;">"Success is the sum of small efforts repeated day in and day out."</p>
      <p id="quote-author" style="font-size: 0.95em; text-align: right; color: rgba(255, 255, 255, 0.8);">- Robert Collier</p>
    </div>
    
    <div style="display: flex; gap: 20px; margin-bottom: 25px; max-width: 1200px; flex-wrap: wrap;">
      <div id="study-timer-section" style="flex: 1; min-width: 400px; padding: 25px; background: rgba(100, 200, 255, 0.2); border-radius: 20px; backdrop-filter: blur(10px); border: 2px solid rgba(100, 200, 255, 0.5);">
        <h3 style="margin-bottom: 15px; font-size: 1.6em;">â±ï¸ Study Session</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
          <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
            <div style="font-size: 1.8em; margin-bottom: 5px;">â°</div>
            <div style="font-size: 1.8em; font-weight: bold; font-family: monospace;" id="session-timer">00:00:00</div>
            <div style="font-size: 0.95em; margin-top: 5px;">Session Time</div>
          </div>
          <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
            <div style="font-size: 1.8em; margin-bottom: 5px;">ğŸ“Š</div>
            <div style="font-size: 1.4em; font-weight: bold;" id="total-study-time">0h 0m</div>
            <div style="font-size: 0.95em; margin-top: 5px;">Total Study Time</div>
          </div>
          <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
            <div style="font-size: 1.8em; margin-bottom: 5px;">ğŸ“…</div>
            <div style="font-size: 1.4em; font-weight: bold;" id="today-study-time">0h 0m</div>
            <div style="font-size: 0.95em; margin-top: 5px;">Today</div>
          </div>
          <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
            <div style="font-size: 1.8em; margin-bottom: 5px;">ğŸ”¥</div>
            <div style="font-size: 1.4em; font-weight: bold;" id="study-streak">0</div>
            <div style="font-size: 0.95em; margin-top: 5px;">Day Streak</div>
          </div>
        </div>
      </div>
      
      <div id="leaderboard-section" style="flex: 1; min-width: 400px; padding: 25px; background: linear-gradient(135deg, rgba(255, 100, 100, 0.2) 0%, rgba(255, 50, 150, 0.2) 100%); border-radius: 20px; backdrop-filter: blur(10px); border: 2px solid rgba(255, 100, 100, 0.4);">
        <h3 style="margin-bottom: 15px; font-size: 1.6em;">ğŸ† Your Records</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
          <div style="background: rgba(255, 215, 0, 0.3); padding: 12px; border-radius: 10px; text-align: center; border: 2px solid rgba(255, 215, 0, 0.5);">
            <div style="font-size: 1.5em; margin-bottom: 5px;">ğŸ¥‡</div>
            <div style="font-size: 1.3em; font-weight: bold;" id="best-streak">0</div>
            <div style="font-size: 0.85em; margin-top: 3px;">Best Streak</div>
          </div>
          <div style="background: rgba(100, 200, 255, 0.3); padding: 12px; border-radius: 10px; text-align: center; border: 2px solid rgba(100, 200, 255, 0.5);">
            <div style="font-size: 1.5em; margin-bottom: 5px;">ğŸ“ˆ</div>
            <div style="font-size: 1.3em; font-weight: bold;" id="best-daily">0</div>
            <div style="font-size: 0.85em; margin-top: 3px;">Most in 1 Day</div>
          </div>
          <div style="background: rgba(150, 100, 255, 0.3); padding: 12px; border-radius: 10px; text-align: center; border: 2px solid rgba(150, 100, 255, 0.5);">
            <div style="font-size: 1.5em; margin-bottom: 5px;">âš¡</div>
            <div style="font-size: 1.3em; font-weight: bold;" id="total-points">0</div>
            <div style="font-size: 0.85em; margin-top: 3px;">Total Points</div>
          </div>
          <div style="background: rgba(255, 150, 50, 0.3); padding: 12px; border-radius: 10px; text-align: center; border: 2px solid rgba(255, 150, 50, 0.5);">
            <div style="font-size: 1.5em; margin-bottom: 5px;">ğŸ¯</div>
            <div style="font-size: 1.3em; font-weight: bold;" id="rank-level">Beginner</div>
            <div style="font-size: 0.85em; margin-top: 3px;">Rank</div>
            <div style="font-size: 0.7em; margin-top: 5px; opacity: 0.8;" id="rank-progress">10 more to Novice</div>
          </div>
        </div>
      </div>
    </div>
    
    <div style="display: flex; gap: 20px; margin-bottom: 30px; max-width: 1200px; flex-wrap: wrap;">
      <div id="stats-dashboard" style="flex: 1; min-width: 400px; padding: 40px; background: rgba(255, 255, 255, 0.15); border-radius: 20px; backdrop-filter: blur(10px); aspect-ratio: 1;">
        <h3 style="margin-bottom: 20px; font-size: 1.8em;">ğŸ“Š Your Progress</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; height: calc(100% - 60px);">
          <div style="background: rgba(102, 126, 234, 0.3); padding: 30px 20px; border-radius: 12px; text-align: center; display: flex; flex-direction: column; justify-content: center;">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“š</div>
            <div style="font-size: 2.5em; font-weight: bold;" id="total-questions">0</div>
            <div style="font-size: 1.1em; margin-top: 5px;">Total Questions</div>
          </div>
          <div style="background: rgba(255, 100, 100, 0.3); padding: 30px 20px; border-radius: 12px; text-align: center; display: flex; flex-direction: column; justify-content: center;">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ”¢</div>
            <div style="font-size: 2.5em; font-weight: bold;" id="math-questions">0</div>
            <div style="font-size: 1.1em; margin-top: 5px;">Math</div>
          </div>
          <div style="background: rgba(100, 200, 255, 0.3); padding: 30px 20px; border-radius: 12px; text-align: center; display: flex; flex-direction: column; justify-content: center;">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“</div>
            <div style="font-size: 2.5em; font-weight: bold;" id="english-questions">0</div>
            <div style="font-size: 1.1em; margin-top: 5px;">English</div>
          </div>
          <div style="background: rgba(100, 255, 150, 0.3); padding: 30px 20px; border-radius: 12px; text-align: center; display: flex; flex-direction: column; justify-content: center;">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ”¬</div>
            <div style="font-size: 2.5em; font-weight: bold;" id="science-questions">0</div>
            <div style="font-size: 1.1em; margin-top: 5px;">Science</div>
          </div>
        </div>
      </div>
      
      <div id="badges-section" style="flex: 1; min-width: 400px; padding: 30px; background: rgba(255, 255, 255, 0.1); border-radius: 20px; backdrop-filter: blur(10px); display: flex; flex-direction: column;">
        <h3 style="margin-bottom: 20px; font-size: 1.8em;">ğŸ† Achievement Badges</h3>
        <div style="display: flex; gap: 25px; justify-content: center; flex-wrap: wrap; flex: 1; align-content: center;">
          <div id="badge-bronze" class="badge-item" style="text-align: center; opacity: 0.3; transition: all 0.3s;">
            <div style="font-size: 4em; margin-bottom: 8px;">ğŸ¥‰</div>
            <div style="font-size: 1.2em; font-weight: bold;">Bronze</div>
            <div style="font-size: 0.9em; margin-top: 5px;">10 Questions</div>
          </div>
          <div id="badge-silver" class="badge-item" style="text-align: center; opacity: 0.3; transition: all 0.3s;">
            <div style="font-size: 4em; margin-bottom: 8px;">ğŸ¥ˆ</div>
            <div style="font-size: 1.2em; font-weight: bold;">Silver</div>
            <div style="font-size: 0.9em; margin-top: 5px;">25 Questions</div>
          </div>
          <div id="badge-gold" class="badge-item" style="text-align: center; opacity: 0.3; transition: all 0.3s;">
            <div style="font-size: 4em; margin-bottom: 8px;">ğŸ¥‡</div>
            <div style="font-size: 1.2em; font-weight: bold;">Gold</div>
            <div style="font-size: 0.9em; margin-top: 5px;">50 Questions</div>
          </div>
          <div id="badge-diamond" class="badge-item" style="text-align: center; opacity: 0.3; transition: all 0.3s;">
            <div style="font-size: 4em; margin-bottom: 8px;">ğŸ’</div>
            <div style="font-size: 1.2em; font-weight: bold;">Diamond</div>
            <div style="font-size: 0.9em; margin-top: 5px;">100 Questions</div>
          </div>
          <div id="badge-platinum" class="badge-item" style="text-align: center; opacity: 0.3; transition: all 0.3s;">
            <div style="font-size: 4em; margin-bottom: 8px;">ğŸ‘‘</div>
            <div style="font-size: 1.2em; font-weight: bold;">Platinum</div>
            <div style="font-size: 0.9em; margin-top: 5px;">250 Questions</div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="daily-challenge-section" style="margin-bottom: 25px; padding: 30px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.3) 0%, rgba(255, 140, 0, 0.3) 100%); border-radius: 20px; backdrop-filter: blur(10px); max-width: 900px; border: 3px solid rgba(255, 215, 0, 0.5);">
      <h3 style="margin-bottom: 20px; font-size: 1.8em;">ğŸ® Daily Challenge</h3>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <div style="background: rgba(255, 255, 255, 0.2); padding: 20px; border-radius: 12px; text-align: center;">
          <div style="font-size: 2.5em; margin-bottom: 8px;">ğŸ”¥</div>
          <div style="font-size: 2em; font-weight: bold;" id="challenge-streak">0</div>
          <div style="font-size: 1em; margin-top: 5px;">Day Streak</div>
        </div>
        <div style="background: rgba(255, 255, 255, 0.2); padding: 20px; border-radius: 12px; text-align: center;">
          <div style="font-size: 2.5em; margin-bottom: 8px;">â­</div>
          <div style="font-size: 2em; font-weight: bold;" id="bonus-points">0</div>
          <div style="font-size: 1em; margin-top: 5px;">Bonus Points</div>
        </div>
      </div>
      
      <div id="challenge-status" style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 12px; text-align: center;">
        <div style="font-size: 1.3em; color: #333; margin-bottom: 15px; font-weight: bold;">ğŸ¯ Today's Challenge</div>
        <div id="challenge-question" style="font-size: 1.1em; color: #555; margin-bottom: 15px; padding: 15px; background: #f9f9f9; border-radius: 8px;">Loading...</div>
        <div id="challenge-input-section" style="margin-top: 20px;">
          <input type="text" id="challenge-answer" placeholder="Type your answer here..." style="width: 80%; max-width: 400px; padding: 15px; font-size: 1.1em; border: 2px solid #ffd700; border-radius: 8px; margin-bottom: 15px; text-align: center;" onkeypress="if(event.key==='Enter') submitChallenge()">
          <br>
          <button onclick="submitChallenge()" style="padding: 15px 40px; font-size: 1.2em; background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%); border: none; color: white; border-radius: 10px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4); transition: all 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            Submit Answer ğŸ†
          </button>
          <div id="challenge-feedback" style="margin-top: 15px; font-size: 1.1em; font-weight: bold;"></div>
        </div>
        <div id="challenge-completed" style="display: none; color: #2ecc71; font-size: 1.3em; font-weight: bold;">
          âœ… Challenge Completed! Come back tomorrow!
        </div>
        <div id="challenge-locked-message" style="display: none; color: #e74c3c; font-size: 1.1em; margin-top: 15px; padding: 15px; background: rgba(231, 76, 60, 0.1); border-radius: 8px; border: 2px solid #e74c3c;">
          ğŸ”’ Complete today's challenge to unlock the homework assistant!
        </div>
      </div>
    </div>
    
    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;">
      <button onclick="toggleHistory()" style="padding: 15px 35px; font-size: 1.2em; background: rgba(255, 255, 255, 0.25); border: 2px solid white; color: white; border-radius: 12px; cursor: pointer; backdrop-filter: blur(10px); font-weight: bold; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.35)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.25)'">
        ğŸ“œ View Question History
      </button>
      <button onclick="openFlashcards()" style="padding: 15px 35px; font-size: 1.2em; background: linear-gradient(135deg, rgba(147, 51, 234, 0.4), rgba(219, 39, 119, 0.4)); border: 2px solid rgba(219, 39, 119, 0.8); color: white; border-radius: 12px; cursor: pointer; backdrop-filter: blur(10px); font-weight: bold; transition: all 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
        ğŸƒ Study Flashcards
      </button>
    </div>
    
    <div class="signin-form-demo">
      <div class="form-field">
        <label>ğŸ“š Subject</label>
        <select id="subject" onchange="updateExample()" style="width: 100%; padding: 15px; font-size: 1.1em; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 10px; background: rgba(255, 255, 255, 0.9); color: #333;">
          <option value="">Select a subject</option>
          <option value="math">Math</option>
          <option value="english">English</option>
          <option value="science">Science</option>
        </select>
      </div>
      
      <div class="form-field">
        <label>ğŸ“ Grade Level</label>
        <select id="grade" style="width: 100%; padding: 15px; font-size: 1.1em; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 10px; background: rgba(255, 255, 255, 0.9); color: #333;">
          <option value="1">Grade 1</option>
          <option value="2">Grade 2</option>
          <option value="3">Grade 3</option>
          <option value="4">Grade 4</option>
          <option value="5">Grade 5</option>
          <option value="6">Grade 6</option>
          <option value="7">Grade 7</option>
          <option value="8">Grade 8</option>
          <option value="9">Grade 9</option>
          <option value="10">Grade 10</option>
          <option value="11">Grade 11</option>
          <option value="12">Grade 12</option>
        </select>
      </div>
      
      <div class="form-field">
        <label>âœï¸ Your Question</label>
        <div style="position: relative;">
          <textarea id="question" placeholder="Select a subject to see an example..." style="width: 100%; padding: 15px; font-size: 1.1em; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 10px; background: rgba(255, 255, 255, 0.2); color: white; min-height: 120px; resize: vertical; padding-right: 60px;"></textarea>
          <button type="button" id="voice-input-btn" onclick="toggleVoiceInput()" style="position: absolute; right: 10px; bottom: 10px; width: 45px; height: 45px; border-radius: 50%; background: rgba(255, 100, 100, 0.3); border: 2px solid white; color: white; font-size: 1.5em; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center;" title="Voice input">
            ğŸ¤
          </button>
        </div>
        <div id="voice-status" style="display: none; margin-top: 10px; padding: 10px; background: rgba(255, 100, 100, 0.2); border-radius: 8px; text-align: center; font-size: 0.95em;">
          <span style="display: inline-block; width: 10px; height: 10px; background: red; border-radius: 50%; animation: pulse 1.5s infinite; margin-right: 8px;"></span>
          Listening... Speak now!
        </div>
      </div>
      
      <div id="math-keyboard" style="margin-top: 10px; display: none; padding: 12px; background: rgba(255, 255, 255, 0.15); border-radius: 10px;">
        <div style="margin-bottom: 8px; font-size: 0.9em; font-weight: bold;">ğŸ”¢ Math Symbols:</div>
        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
          <button type="button" onclick="insertSymbol('Ã—')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">Ã—</button>
          <button type="button" onclick="insertSymbol('Ã·')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">Ã·</button>
          <button type="button" onclick="insertSymbol('Â²')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">xÂ²</button>
          <button type="button" onclick="insertSymbol('Â³')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">xÂ³</button>
          <button type="button" onclick="insertSymbol('âˆš')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">âˆš</button>
          <button type="button" onclick="insertSymbol('Ï€')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">Ï€</button>
          <button type="button" onclick="insertSymbol('âˆ')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">âˆ</button>
          <button type="button" onclick="insertSymbol('â‰ˆ')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">â‰ˆ</button>
          <button type="button" onclick="insertSymbol('â‰¤')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">â‰¤</button>
          <button type="button" onclick="insertSymbol('â‰¥')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">â‰¥</button>
          <button type="button" onclick="insertSymbol('Â±')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">Â±</button>
          <button type="button" onclick="insertSymbol('Â°')" style="padding: 10px 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold;">Â°</button>
        </div>
      </div>

      <div class="form-field">
        <label>ğŸ“¸ Or Upload Homework Picture</label>
        <div style="position: relative;">
          <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
          <button type="button" onclick="document.getElementById('imageUpload').click()" style="width: 100%; padding: 15px; font-size: 1.1em; border: 2px dashed rgba(255, 255, 255, 0.5); border-radius: 10px; background: rgba(255, 255, 255, 0.1); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <span style="font-size: 2em;">ğŸ“·</span>
            <span>Click to upload image</span>
          </button>
          <div id="imagePreview" style="display: none; margin-top: 15px; text-align: center;">
            <img id="previewImg" style="max-width: 100%; max-height: 300px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
            <p id="imageName" style="margin-top: 10px; font-size: 0.9em; color: #fff;"></p>
          </div>
        </div>
      </div>
      
      <button class="demo-button" onclick="getAnswer()">Get Answer ğŸš€</button>
      
      <div id="answer-section" style="display: none; margin-top: 30px; padding: 30px; background: rgba(255, 255, 255, 0.95); border-radius: 15px; text-align: left; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); position: relative;">
        <button type="button" id="read-aloud-btn" onclick="toggleReadAloud()" style="position: absolute; top: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 2px solid white; color: white; font-size: 1.8em; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);" title="Read answer aloud" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
          ğŸ”Š
        </button>
        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.5em;">ğŸ’¡ Solution:</h3>
        <p id="solution" style="font-size: 1.4em; color: #333; margin-bottom: 25px; font-weight: bold; background: #f0f0f0; padding: 15px; border-radius: 8px;"></p>
        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.5em;">ğŸ“– Explanation:</h3>
        <p id="explanation" style="font-size: 1.2em; color: #333; white-space: pre-wrap; line-height: 1.8; background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;"></p>
      </div>
    </div>
    
    <div style="margin-top: 30px; display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
      <p style="font-size: 1.2em;">âœ“ Natural language support</p>
      <p style="font-size: 1.2em;">âœ“ Upload homework photos</p>
      <p style="font-size: 1.2em;">âœ“ Detailed explanations</p>
      <p style="font-size: 1.2em;">âœ“ Step-by-step solutions</p>
    </div>
  </div>

  <!-- Navigation Controls -->
  <div class="controls">
    <button onclick="previousSlide()">â—€ Previous</button>
    <button onclick="nextSlide()">Next â–¶</button>
  </div>

  <div class="slide-number">
    <span id="currentSlide">1</span> / <span id="totalSlides">1</span>
  </div>

  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <!-- History Modal -->
  <div id="history-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.8); z-index: 2000; overflow-y: auto; padding: 40px;">
    <div style="max-width: 1000px; margin: 0 auto; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 40px; position: relative;">
      <button onclick="toggleHistory()" style="position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; font-size: 1.5em; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-weight: bold;">Ã—</button>
      
      <h2 style="margin-bottom: 25px; font-size: 2.5em; color: white;">ğŸ“œ Question History</h2>
      
      <div style="margin-bottom: 25px; display: flex; gap: 15px; flex-wrap: wrap;">
        <button onclick="filterHistory('all')" id="filter-all" style="padding: 12px 25px; background: rgba(255, 255, 255, 0.9); border: 2px solid white; color: #667eea; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em;">All</button>
        <button onclick="filterHistory('math')" id="filter-math" style="padding: 12px 25px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em;">ğŸ”¢ Math</button>
        <button onclick="filterHistory('english')" id="filter-english" style="padding: 12px 25px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em;">ğŸ“ English</button>
        <button onclick="filterHistory('science')" id="filter-science" style="padding: 12px 25px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em;">ğŸ”¬ Science</button>
      </div>
      
      <div id="history-list" style="display: flex; flex-direction: column; gap: 15px;">
        <!-- History items will be inserted here -->
      </div>
      
      <div id="empty-history" style="display: none; text-align: center; padding: 60px 20px; color: white; font-size: 1.3em;">
        <div style="font-size: 4em; margin-bottom: 15px;">ğŸ“­</div>
        <p>No questions yet! Start asking to build your history.</p>
      </div>
    </div>
  </div>

  <!-- Flashcards Modal -->
  <div id="flashcard-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 1000; overflow-y: auto; padding: 20px;">
    <div style="max-width: 800px; margin: 0 auto; position: relative;">
      <button onclick="closeFlashcards()" style="position: absolute; top: 10px; right: 10px; padding: 10px 20px; background: rgba(231, 76, 60, 0.8); border: none; color: white; border-radius: 8px; cursor: pointer; font-size: 1.2em; font-weight: bold; z-index: 10;">âœ• Close</button>
      
      <h2 style="color: white; text-align: center; margin-bottom: 20px; font-size: 2em;">ğŸƒ Study Flashcards</h2>
      
      <div style="text-align: center; margin-bottom: 20px;">
        <button onclick="filterFlashcards('all')" id="fc-filter-all" style="padding: 10px 20px; margin: 5px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; font-weight: bold;">All</button>
        <button onclick="filterFlashcards('math')" id="fc-filter-math" style="padding: 10px 20px; margin: 5px; background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.5); color: white; border-radius: 8px; cursor: pointer;">Math</button>
        <button onclick="filterFlashcards('english')" id="fc-filter-english" style="padding: 10px 20px; margin: 5px; background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.5); color: white; border-radius: 8px; cursor: pointer;">English</button>
        <button onclick="filterFlashcards('science')" id="fc-filter-science" style="padding: 10px 20px; margin: 5px; background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.5); color: white; border-radius: 8px; cursor: pointer;">Science</button>
      </div>
      
      <div id="flashcard-progress" style="text-align: center; color: white; font-size: 1.2em; margin-bottom: 20px; font-weight: bold;">
        Card 0 / 0
      </div>
      
      <div id="flashcard-container" style="perspective: 1000px; margin-bottom: 30px;">
        <div id="flashcard" style="width: 100%; min-height: 400px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; border-radius: 20px;">
          <div id="card-front" style="position: absolute; width: 100%; min-height: 400px; backface-visibility: hidden; background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(147, 51, 234, 0.9)); border-radius: 20px; padding: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
            <div style="font-size: 1.5em; margin-bottom: 15px; color: rgba(255, 255, 255, 0.8);">Question</div>
            <p id="card-question" style="font-size: 1.3em; color: white; text-align: center; line-height: 1.6; margin-bottom: 25px;">Click "Study Flashcards" to start!</p>
            <div style="width: 100%; max-width: 500px;">
              <input type="text" id="card-answer-input" placeholder="Type your answer here..." style="width: 100%; padding: 15px; font-size: 1.1em; border: 2px solid white; border-radius: 10px; background: rgba(255, 255, 255, 0.9); color: #333; margin-bottom: 15px;" onkeypress="if(event.key === 'Enter') checkAnswer()">
              <button onclick="checkAnswer()" id="show-answer-btn" style="width: 100%; padding: 15px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.4)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.3)'">Show Answer â†’</button>
            </div>
            <div style="margin-top: 20px; font-size: 0.95em; color: rgba(255, 255, 255, 0.7);">ğŸ’¡ Type your answer first, then click Show Answer</div>
          </div>
          <div id="card-back" style="position: absolute; width: 100%; min-height: 400px; backface-visibility: hidden; background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(5, 150, 105, 0.9)); border-radius: 20px; padding: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; transform: rotateY(180deg); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
            <div style="font-size: 1.5em; margin-bottom: 15px; color: rgba(255, 255, 255, 0.8);">Correct Answer</div>
            <p id="card-answer" style="font-size: 1.2em; color: white; text-align: center; line-height: 1.6; margin-bottom: 20px;"></p>
            <div id="user-answer-display" style="margin-top: 15px; padding: 15px; background: rgba(255, 255, 255, 0.2); border-radius: 10px; width: 100%; max-width: 500px;">
              <div style="font-size: 0.95em; margin-bottom: 5px; color: rgba(255, 255, 255, 0.8);">Your Answer:</div>
              <div id="user-answer-text" style="font-size: 1.1em; color: white; font-weight: bold;"></div>
            </div>
            <button onclick="flipCard()" style="margin-top: 20px; padding: 12px 25px; background: rgba(255, 255, 255, 0.3); border: 2px solid white; color: white; border-radius: 10px; cursor: pointer; font-size: 1em; font-weight: bold;">â† Back to Question</button>
          </div>
        </div>
      </div>
      
      <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
        <button onclick="prevCard()" style="padding: 15px 30px; background: rgba(255, 255, 255, 0.2); border: 2px solid white; color: white; border-radius: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">â¬…ï¸ Previous</button>
        <button onclick="markCard('got-it')" style="padding: 15px 30px; background: rgba(34, 197, 94, 0.3); border: 2px solid #22c55e; color: white; border-radius: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">âœ… Got it!</button>
        <button onclick="markCard('need-review')" style="padding: 15px 30px; background: rgba(239, 68, 68, 0.3); border: 2px solid #ef4444; color: white; border-radius: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">âŒ Need Review</button>
        <button onclick="nextCard()" style="padding: 15px 30px; background: rgba(255, 255, 255, 0.2); border: 2px solid white; color: white; border-radius: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">Next â¡ï¸</button>
      </div>
      
      <div id="flashcard-stats" style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin-top: 20px;">
        <div style="display: flex; justify-content: space-around; color: white; font-size: 1.1em;">
          <div style="text-align: center;">
            <div style="font-size: 1.8em; color: #22c55e;" id="got-it-count">0</div>
            <div>Got it!</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 1.8em; color: #ef4444;" id="need-review-count">0</div>
            <div>Need Review</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 1.8em; color: #fbbf24;" id="not-reviewed-count">0</div>
            <div>Not Reviewed</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Theme management
    let isDarkMode = localStorage.getItem('theme') !== 'light';
    
    function toggleTheme() {
      isDarkMode = !isDarkMode;
      const body = document.body;
      const btn = document.getElementById('theme-toggle-btn');
      
      if (isDarkMode) {
        body.classList.remove('light-mode');
        btn.textContent = 'ğŸŒ™ Dark';
        localStorage.setItem('theme', 'dark');
      } else {
        body.classList.add('light-mode');
        btn.textContent = 'â˜€ï¸ Light';
        localStorage.setItem('theme', 'light');
      }
    }
    
    // Load saved theme
    if (!isDarkMode) {
      document.body.classList.add('light-mode');
      document.getElementById('theme-toggle-btn').textContent = 'â˜€ï¸ Light';
    }
    
    // Loading animation
    function showLoading() {
      document.getElementById('loading-overlay').classList.add('active');
    }
    
    function hideLoading() {
      document.getElementById('loading-overlay').classList.remove('active');
    }
    
    let currentSlide = 0;
    let slides = [];
    let totalSlides = 0;
    let isSignedIn = localStorage.getItem('isSignedIn') === 'true';
    let slidesInitialized = false;
    
    // Initialize slides - MUST be called before any slide navigation
    function initializeSlides() {
      if (slidesInitialized) return; // Prevent double initialization
      
      slides = document.querySelectorAll('.slide');
      totalSlides = slides.length;
      slidesInitialized = true;
      
      console.log('=== SLIDE INITIALIZATION ===');
      console.log('Found slides:', slides.length);
      slides.forEach((slide, i) => {
        console.log(`  Slide ${i+1}:`, slide.querySelector('h1')?.textContent, '- Active:', slide.classList.contains('active'));
      });
      
      const totalSlidesEl = document.getElementById('totalSlides');
      if (totalSlidesEl) {
        totalSlidesEl.textContent = totalSlides;
      }
      
      console.log('Slides initialized successfully. Total:', totalSlides);
    }
    
    // Run initialization when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeSlides);
    } else {
      // DOM is already loaded
      initializeSlides();
    }

    // Stats tracking
    let stats = JSON.parse(localStorage.getItem('homeworkStats')) || {
      total: 0,
      math: 0,
      english: 0,
      science: 0
    };
    
    // Badge milestones
    const badgeMilestones = {
      bronze: 10,
      silver: 25,
      gold: 50,
      diamond: 100,
      platinum: 250
    };
    
    // Rank system based on total questions solved
    const rankTiers = [
      { name: 'Beginner', min: 0, max: 9, emoji: 'ğŸŒ±', color: 'rgba(150, 150, 150, 0.5)' },
      { name: 'Novice', min: 10, max: 24, emoji: 'â­', color: 'rgba(255, 215, 0, 0.3)' },
      { name: 'Apprentice', min: 25, max: 49, emoji: 'ğŸ”¥', color: 'rgba(255, 150, 50, 0.3)' },
      { name: 'Scholar', min: 50, max: 99, emoji: 'ğŸ“š', color: 'rgba(100, 200, 255, 0.3)' },
      { name: 'Expert', min: 100, max: 199, emoji: 'ğŸ“', color: 'rgba(150, 100, 255, 0.3)' },
      { name: 'Master', min: 200, max: 349, emoji: 'ğŸ’', color: 'rgba(100, 255, 200, 0.3)' },
      { name: 'Grandmaster', min: 350, max: 499, emoji: 'ğŸ‘‘', color: 'rgba(255, 100, 150, 0.3)' },
      { name: 'Legend', min: 500, max: Infinity, emoji: 'ğŸ†', color: 'rgba(255, 215, 0, 0.5)' }
    ];
    
    let unlockedBadges = JSON.parse(localStorage.getItem('unlockedBadges')) || [];
    
    // Question history
    let questionHistory = JSON.parse(localStorage.getItem('questionHistory')) || [];
    let currentFilter = 'all';
    
    // Study timer data
    let studyData = JSON.parse(localStorage.getItem('studyData')) || {
      totalMinutes: 0,
      todayMinutes: 0,
      lastStudyDate: null,
      studyStreak: 0,
      lastStreakDate: null
    };
    
    let sessionStartTime = null;
    let sessionTimerInterval = null;
    let sessionSeconds = 0;
    
    // Leaderboard data
    let leaderboardData = JSON.parse(localStorage.getItem('leaderboardData')) || {
      bestStreak: 0,
      bestDaily: 0,
      totalPoints: 0
    };
    
    // Motivational quotes
    const motivationalQuotes = [
      { text: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
      { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
      { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
      { text: "Education is the passport to the future.", author: "Malcolm X" },
      { text: "The expert in anything was once a beginner.", author: "Helen Hayes" },
      { text: "Learning never exhausts the mind.", author: "Leonardo da Vinci" },
      { text: "The more that you read, the more things you will know.", author: "Dr. Seuss" },
      { text: "Intelligence plus characterâ€”that is the goal of true education.", author: "Martin Luther King Jr." },
      { text: "Study while others are sleeping; work while others are loafing.", author: "William A. Ward" },
      { text: "Practice isn't the thing you do once you're good. It's what makes you good.", author: "Malcolm Gladwell" }
    ];
    
    // Flashcard system
    let flashcardData = JSON.parse(localStorage.getItem('flashcardData')) || {};
    let currentFlashcardIndex = 0;
    let filteredFlashcards = [];
    let currentFlashcardFilter = 'all';
    let isCardFlipped = false;
    
    // Daily challenge data
    let challengeData = JSON.parse(localStorage.getItem('challengeData')) || {
      streak: 0,
      bonusPoints: 0,
      lastCompleted: null,
      lastGenerated: null,
      todayQuestion: null,
      todaySubject: null
    };
    
    const dailyChallenges = {
      math: [
        { question: "What is 15 Ã— 8?", answer: "120" },
        { question: "Solve: 3x + 7 = 22", answer: "5" },
        { question: "What is 25% of 200?", answer: "50" },
        { question: "Calculate: 144 Ã· 12", answer: "12" },
        { question: "What is the area of a rectangle with length 8 and width 5?", answer: "40" },
        { question: "Solve: 2(x + 4) = 18", answer: "5" },
        { question: "What is 7Â²?", answer: "49" },
        { question: "Calculate: 15 + 8 Ã— 3", answer: "39" }
      ],
      english: [
        { question: "What is a synonym for 'happy'?", answer: "joyful" },
        { question: "Identify the verb in: 'The cat sleeps peacefully.'", answer: "sleeps" },
        { question: "What is the plural of 'child'?", answer: "children" },
        { question: "What part of speech is 'quickly'?", answer: "adverb" },
        { question: "What is an antonym for 'brave'?", answer: "cowardly" },
        { question: "What is the past tense of 'run'?", answer: "ran" },
        { question: "What punctuation ends a question?", answer: "question mark" },
        { question: "How many vowels are in the English alphabet?", answer: "5" }
      ],
      science: [
        { question: "What is the chemical symbol for water?", answer: "h2o" },
        { question: "How many states of matter are there?", answer: "3" },
        { question: "How many planets are in our solar system?", answer: "8" },
        { question: "What is the boiling point of water in Celsius?", answer: "100" },
        { question: "What gas do plants produce during photosynthesis?", answer: "oxygen" },
        { question: "What is the largest organ in the human body?", answer: "skin" },
        { question: "What force pulls objects toward Earth?", answer: "gravity" },
        { question: "How many bones are in the adult human body?", answer: "206" }
      ]
    };
    
    // Load stats on page load
    function loadStats() {
      document.getElementById('total-questions').textContent = stats.total;
      document.getElementById('math-questions').textContent = stats.math;
      document.getElementById('english-questions').textContent = stats.english;
      document.getElementById('science-questions').textContent = stats.science;
      updateRank();
    }
    
    // Calculate and display user rank
    function updateRank() {
      const total = stats.total;
      const currentRank = rankTiers.find(rank => total >= rank.min && total <= rank.max);
      
      if (currentRank) {
        const rankEl = document.getElementById('rank-level');
        const rankCard = rankEl.closest('div[style*="rgba(255, 150, 50"]');
        
        rankEl.textContent = currentRank.name;
        
        // Update rank card color
        if (rankCard) {
          rankCard.style.background = currentRank.color;
          rankCard.style.borderColor = currentRank.color.replace('0.3', '0.6');
          
          // Update emoji
          const emojiEl = rankCard.querySelector('div[style*="font-size: 1.5em"]');
          if (emojiEl) {
            emojiEl.textContent = currentRank.emoji;
          }
        }
        
        // Show progress to next rank
        const nextRank = rankTiers.find(rank => rank.min > total);
        if (nextRank) {
          const questionsNeeded = nextRank.min - total;
          const progressText = document.getElementById('rank-progress');
          if (progressText) {
            progressText.textContent = `${questionsNeeded} more to ${nextRank.name}`;
          }
        }
      }
    }
    
    // Load and display badges
    function loadBadges() {
      Object.keys(badgeMilestones).forEach(badge => {
        const badgeEl = document.getElementById('badge-' + badge);
        if (unlockedBadges.includes(badge)) {
          badgeEl.style.opacity = '1';
          badgeEl.style.transform = 'scale(1.05)';
          badgeEl.style.filter = 'drop-shadow(0 0 10px rgba(255, 215, 0, 0.5))';
        }
      });
    }
    
    // Check and unlock new badges
    function checkBadges() {
      const newBadges = [];
      Object.keys(badgeMilestones).forEach(badge => {
        if (stats.total >= badgeMilestones[badge] && !unlockedBadges.includes(badge)) {
          unlockedBadges.push(badge);
          newBadges.push(badge);
        }
      });
      
      if (newBadges.length > 0) {
        localStorage.setItem('unlockedBadges', JSON.stringify(unlockedBadges));
        loadBadges();
        
        // Show celebration
        newBadges.forEach(badge => {
          const badgeName = badge.charAt(0).toUpperCase() + badge.slice(1);
          setTimeout(() => {
            alert('ğŸ‰ Congratulations! You unlocked the ' + badgeName + ' badge!');
          }, 500);
        });
      }
    }
    
    // Update stats after each question
    function updateStats(subject) {
      const oldRank = rankTiers.find(rank => stats.total >= rank.min && stats.total <= rank.max);
      
      stats.total++;
      if (subject === 'math') stats.math++;
      else if (subject === 'english') stats.english++;
      else if (subject === 'science') stats.science++;
      
      localStorage.setItem('homeworkStats', JSON.stringify(stats));
      
      const newRank = rankTiers.find(rank => stats.total >= rank.min && stats.total <= rank.max);
      
      loadStats();
      checkBadges();
      
      // Check for rank up
      if (oldRank && newRank && oldRank.name !== newRank.name) {
        setTimeout(() => {
          alert(`ğŸ‰ RANK UP! You are now ${newRank.emoji} ${newRank.name}!`);
        }, 800);
      }
    }
    
    loadStats();
    loadBadges();
    loadDailyChallenge();
    
    // Voice recognition setup
    let recognition = null;
    let isListening = false;
    let speechSynthesis = window.speechSynthesis;
    let currentSpeech = null;
    
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('question').value = transcript;
        stopVoiceInput();
      };
      
      recognition.onerror = function(event) {
        console.error('Speech recognition error:', event.error);
        stopVoiceInput();
        if (event.error !== 'no-speech') {
          alert('Voice input error: ' + event.error);
        }
      };
      
      recognition.onend = function() {
        stopVoiceInput();
      };
    }
    
    // Toggle voice input
    function toggleVoiceInput() {
      if (!recognition) {
        alert('âš ï¸ Voice input is not supported in this browser. Try Chrome or Edge.');
        return;
      }
      
      if (isListening) {
        stopVoiceInput();
      } else {
        startVoiceInput();
      }
    }
    
    // Start voice input
    function startVoiceInput() {
      const btn = document.getElementById('voice-input-btn');
      const status = document.getElementById('voice-status');
      
      isListening = true;
      btn.style.background = 'rgba(255, 50, 50, 0.8)';
      btn.style.animation = 'pulse 1.5s infinite';
      status.style.display = 'block';
      
      recognition.start();
    }
    
    // Stop voice input
    function stopVoiceInput() {
      const btn = document.getElementById('voice-input-btn');
      const status = document.getElementById('voice-status');
      
      isListening = false;
      btn.style.background = 'rgba(255, 100, 100, 0.3)';
      btn.style.animation = 'none';
      status.style.display = 'none';
      
      if (recognition) {
        recognition.stop();
      }
    }
    
    // Toggle read aloud
    function toggleReadAloud() {
      if (currentSpeech && speechSynthesis.speaking) {
        speechSynthesis.cancel();
        currentSpeech = null;
        document.getElementById('read-aloud-btn').textContent = 'ğŸ”Š';
      } else {
        readAnswerAloud();
      }
    }
    
    // Read answer aloud
    function readAnswerAloud() {
      const solution = document.getElementById('solution').textContent;
      const explanation = document.getElementById('explanation').textContent;
      const btn = document.getElementById('read-aloud-btn');
      
      if (!solution) return;
      
      // Cancel any ongoing speech
      speechSynthesis.cancel();
      
      // Create speech
      const text = 'Solution: ' + solution + '. Explanation: ' + explanation;
      currentSpeech = new SpeechSynthesisUtterance(text);
      currentSpeech.rate = 0.9;
      currentSpeech.pitch = 1;
      currentSpeech.volume = 1;
      
      // Update button during speech
      btn.textContent = 'â¸ï¸';
      
      currentSpeech.onend = function() {
        btn.textContent = 'ğŸ”Š';
        currentSpeech = null;
      };
      
      speechSynthesis.speak(currentSpeech);
    }
    
    // Study timer functions
    function startStudySession() {
      sessionStartTime = Date.now();
      sessionSeconds = 0;
      
      // Update session timer every second
      sessionTimerInterval = setInterval(() => {
        sessionSeconds++;
        updateSessionTimer();
        
        // Save progress every minute
        if (sessionSeconds % 60 === 0) {
          saveStudyProgress();
        }
      }, 1000);
      
      // Check and update streak
      updateStudyStreak();
      
      // Display current stats
      displayStudyStats();
    }
    
    function stopStudySession() {
      if (sessionTimerInterval) {
        clearInterval(sessionTimerInterval);
        sessionTimerInterval = null;
        saveStudyProgress();
      }
    }
    
    function updateSessionTimer() {
      const hours = Math.floor(sessionSeconds / 3600);
      const minutes = Math.floor((sessionSeconds % 3600) / 60);
      const secs = sessionSeconds % 60;
      
      const timerEl = document.getElementById('session-timer');
      if (timerEl) {
        timerEl.textContent = 
          String(hours).padStart(2, '0') + ':' + 
          String(minutes).padStart(2, '0') + ':' + 
          String(secs).padStart(2, '0');
      }
    }
    
    function saveStudyProgress() {
      const minutesStudied = Math.floor(sessionSeconds / 60);
      const today = new Date().toDateString();
      
      // Update total time
      studyData.totalMinutes += minutesStudied - (studyData.sessionSaved || 0);
      studyData.sessionSaved = minutesStudied;
      
      // Update today's time
      if (studyData.lastStudyDate === today) {
        studyData.todayMinutes += minutesStudied - (studyData.sessionSaved || 0);
      } else {
        studyData.todayMinutes = minutesStudied;
        studyData.lastStudyDate = today;
      }
      
      localStorage.setItem('studyData', JSON.stringify(studyData));
      displayStudyStats();
    }
    
    function updateStudyStreak() {
      const today = new Date().toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();
      
      if (studyData.lastStreakDate === yesterday) {
        studyData.studyStreak++;
        studyData.lastStreakDate = today;
      } else if (studyData.lastStreakDate !== today) {
        studyData.studyStreak = 1;
        studyData.lastStreakDate = today;
      }
      
      localStorage.setItem('studyData', JSON.stringify(studyData));
    }
    
    function displayStudyStats() {
      const totalHours = Math.floor(studyData.totalMinutes / 60);
      const totalMins = studyData.totalMinutes % 60;
      
      const todayHours = Math.floor(studyData.todayMinutes / 60);
      const todayMins = studyData.todayMinutes % 60;
      
      const totalEl = document.getElementById('total-study-time');
      const todayEl = document.getElementById('today-study-time');
      const streakEl = document.getElementById('study-streak');
      
      if (totalEl) totalEl.textContent = totalHours + 'h ' + totalMins + 'm';
      if (todayEl) todayEl.textContent = todayHours + 'h ' + todayMins + 'm';
      if (streakEl) streakEl.textContent = studyData.studyStreak;
    }
    
    // Reset today's time if it's a new day
    function checkAndResetDaily() {
      const today = new Date().toDateString();
      if (studyData.lastStudyDate !== today && studyData.lastStudyDate !== null) {
        studyData.todayMinutes = 0;
        studyData.sessionSaved = 0;
      }
    }
    
    checkAndResetDaily();
    loadDailyQuote();
    loadLeaderboard();
    
    // Flashcard functions
    function openFlashcards() {
      const history = JSON.parse(localStorage.getItem('questionHistory')) || [];
      if (history.length === 0) {
        alert('No questions in history yet! Ask some questions first to create flashcards.');
        return;
      }
      
      currentFlashcardFilter = 'all';
      filterFlashcards('all');
      document.getElementById('flashcard-modal').style.display = 'block';
    }
    
    function closeFlashcards() {
      document.getElementById('flashcard-modal').style.display = 'none';
      localStorage.setItem('flashcardData', JSON.stringify(flashcardData));
    }
    
    function filterFlashcards(subject) {
      const history = JSON.parse(localStorage.getItem('questionHistory')) || [];
      currentFlashcardFilter = subject;
      
      // Update filter button styles
      ['all', 'math', 'english', 'science'].forEach(s => {
        const btn = document.getElementById('fc-filter-' + s);
        if (s === subject) {
          btn.style.background = 'rgba(255, 255, 255, 0.3)';
          btn.style.border = '2px solid white';
          btn.style.fontWeight = 'bold';
        } else {
          btn.style.background = 'rgba(255, 255, 255, 0.2)';
          btn.style.border = '2px solid rgba(255, 255, 255, 0.5)';
          btn.style.fontWeight = 'normal';
        }
      });
      
      if (subject === 'all') {
        filteredFlashcards = history;
      } else {
        filteredFlashcards = history.filter(item => item.subject === subject);
      }
      
      if (filteredFlashcards.length === 0) {
        alert('No questions found for this subject!');
        return;
      }
      
      currentFlashcardIndex = 0;
      isCardFlipped = false;
      loadFlashcard(0);
      updateFlashcardStats();
    }
    
    function loadFlashcard(index) {
      if (filteredFlashcards.length === 0) return;
      
      const card = filteredFlashcards[index];
      const cardId = card.timestamp;
      
      // Reset flip
      if (isCardFlipped) {
        flipCard();
      }
      
      // Clear input field
      document.getElementById('card-answer-input').value = '';
      
      document.getElementById('card-question').textContent = card.question;
      document.getElementById('card-answer').textContent = card.solution + '\n\n' + card.explanation;
      document.getElementById('flashcard-progress').textContent = `Card ${index + 1} / ${filteredFlashcards.length}`;
      
      updateFlashcardStats();
    }
    
    function checkAnswer() {
      const userAnswer = document.getElementById('card-answer-input').value.trim();
      
      if (!userAnswer) {
        alert('âš ï¸ Please type your answer first!');
        return;
      }
      
      // Get current card's correct answer
      const currentCard = filteredFlashcards[currentFlashcardIndex];
      const correctAnswer = currentCard ? currentCard.solution : '';
      
      // Normalize answers for comparison (case-insensitive, remove extra spaces)
      const normalizedUserAnswer = userAnswer.toLowerCase().replace(/\s+/g, ' ').trim();
      const normalizedCorrectAnswer = correctAnswer.toLowerCase().replace(/\s+/g, ' ').trim();
      
      // Check if answer is correct
      const isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;
      
      // Display user's answer on the back with correctness indicator
      const userAnswerDisplay = document.getElementById('user-answer-text');
      userAnswerDisplay.textContent = userAnswer;
      
      // Add visual feedback
      const userAnswerContainer = document.getElementById('user-answer-display');
      if (isCorrect) {
        userAnswerContainer.style.background = 'rgba(34, 197, 94, 0.3)';
        userAnswerContainer.style.border = '2px solid #22c55e';
        userAnswerDisplay.innerHTML = 'âœ… ' + userAnswer + ' - Correct!';
      } else {
        userAnswerContainer.style.background = 'rgba(239, 68, 68, 0.3)';
        userAnswerContainer.style.border = '2px solid #ef4444';
        userAnswerDisplay.innerHTML = 'âŒ ' + userAnswer + ' - Incorrect';
      }
      
      // Flip the card
      flipCard();
    }
    
    function flipCard() {
      const card = document.getElementById('flashcard');
      isCardFlipped = !isCardFlipped;
      
      if (isCardFlipped) {
        card.style.transform = 'rotateY(180deg)';
      } else {
        card.style.transform = 'rotateY(0deg)';
        // Reset user answer input and feedback when flipping back
        document.getElementById('card-answer-input').value = '';
        const userAnswerContainer = document.getElementById('user-answer-display');
        userAnswerContainer.style.background = 'rgba(255, 255, 255, 0.2)';
        userAnswerContainer.style.border = 'none';
      }
    }
    
    function nextCard() {
      if (filteredFlashcards.length === 0) return;
      currentFlashcardIndex = (currentFlashcardIndex + 1) % filteredFlashcards.length;
      loadFlashcard(currentFlashcardIndex);
    }
    
    function prevCard() {
      if (filteredFlashcards.length === 0) return;
      currentFlashcardIndex = (currentFlashcardIndex - 1 + filteredFlashcards.length) % filteredFlashcards.length;
      loadFlashcard(currentFlashcardIndex);
    }
    
    function markCard(status) {
      if (filteredFlashcards.length === 0) return;
      
      const card = filteredFlashcards[currentFlashcardIndex];
      const cardId = card.timestamp;
      
      flashcardData[cardId] = status;
      localStorage.setItem('flashcardData', JSON.stringify(flashcardData));
      
      updateFlashcardStats();
      
      // Move to next card
      setTimeout(() => {
        nextCard();
      }, 300);
    }
    
    function updateFlashcardStats() {
      let gotIt = 0;
      let needReview = 0;
      let notReviewed = 0;
      
      filteredFlashcards.forEach(card => {
        const status = flashcardData[card.timestamp];
        if (status === 'got-it') gotIt++;
        else if (status === 'need-review') needReview++;
        else notReviewed++;
      });
      
      document.getElementById('got-it-count').textContent = gotIt;
      document.getElementById('need-review-count').textContent = needReview;
      document.getElementById('not-reviewed-count').textContent = notReviewed;
    }
    
    // Insert math symbol
    function insertSymbol(symbol) {
      const questionField = document.getElementById('question');
      const start = questionField.selectionStart;
      const end = questionField.selectionEnd;
      const text = questionField.value;
      
      questionField.value = text.substring(0, start) + symbol + text.substring(end);
      questionField.focus();
      questionField.selectionStart = questionField.selectionEnd = start + symbol.length;
    }
    
    // Load daily motivational quote
    function loadDailyQuote() {
      const today = new Date().toDateString();
      const lastQuoteDate = localStorage.getItem('lastQuoteDate');
      let quoteIndex = parseInt(localStorage.getItem('quoteIndex') || '0');
      
      // Change quote daily
      if (lastQuoteDate !== today) {
        quoteIndex = Math.floor(Math.random() * motivationalQuotes.length);
        localStorage.setItem('quoteIndex', quoteIndex);
        localStorage.setItem('lastQuoteDate', today);
      }
      
      const quote = motivationalQuotes[quoteIndex];
      document.getElementById('quote-text').textContent = '"' + quote.text + '"';
      document.getElementById('quote-author').textContent = '- ' + quote.author;
    }
    
    // Load leaderboard stats
    function loadLeaderboard() {
      // Update best records
      if (stats.total > leaderboardData.bestDaily) {
        const today = new Date().toDateString();
        const lastRecordDate = localStorage.getItem('lastRecordDate');
        if (lastRecordDate === today) {
          leaderboardData.bestDaily = stats.total;
        }
      }
      
      if (challengeData.streak > leaderboardData.bestStreak) {
        leaderboardData.bestStreak = challengeData.streak;
      }
      
      // Calculate total points (questions + bonus points)
      leaderboardData.totalPoints = stats.total * 5 + (challengeData.bonusPoints || 0);
      
      // Determine rank
      let rank = 'Beginner';
      if (leaderboardData.totalPoints >= 1000) rank = 'Legend';
      else if (leaderboardData.totalPoints >= 500) rank = 'Expert';
      else if (leaderboardData.totalPoints >= 250) rank = 'Advanced';
      else if (leaderboardData.totalPoints >= 100) rank = 'Intermediate';
      
      // Update display
      document.getElementById('best-streak').textContent = leaderboardData.bestStreak;
      document.getElementById('best-daily').textContent = leaderboardData.bestDaily;
      document.getElementById('total-points').textContent = leaderboardData.totalPoints;
      document.getElementById('rank-level').textContent = rank;
      
      localStorage.setItem('leaderboardData', JSON.stringify(leaderboardData));
    }
    
    // Load daily challenge
    function loadDailyChallenge() {
      const today = new Date().toDateString();
      const streakEl = document.getElementById('challenge-streak');
      const pointsEl = document.getElementById('bonus-points');
      const questionEl = document.getElementById('challenge-question');
      const inputSection = document.getElementById('challenge-input-section');
      const completedEl = document.getElementById('challenge-completed');
      const feedbackEl = document.getElementById('challenge-feedback');
      
      // Update display
      streakEl.textContent = challengeData.streak;
      pointsEl.textContent = challengeData.bonusPoints;
      
      // Check if already completed today
      if (challengeData.lastCompleted === today) {
        inputSection.style.display = 'none';
        completedEl.style.display = 'block';
        questionEl.textContent = challengeData.todayQuestion;
        toggleHomeworkAssistant(true); // Enable homework assistant
        return;
      }
      
      // Generate new challenge if needed
      if (challengeData.lastGenerated !== today) {
        generateDailyChallenge();
      }
      
      questionEl.textContent = challengeData.todayQuestion;
      inputSection.style.display = 'block';
      completedEl.style.display = 'none';
      feedbackEl.textContent = '';
      document.getElementById('challenge-answer').value = '';
      toggleHomeworkAssistant(false); // Disable homework assistant
    }
    
    // Generate daily challenge
    function generateDailyChallenge() {
      const subjects = ['math', 'english', 'science'];
      const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
      const questions = dailyChallenges[randomSubject];
      const randomChallenge = questions[Math.floor(Math.random() * questions.length)];
      
      const subjectEmoji = randomSubject === 'math' ? 'ğŸ”¢' : randomSubject === 'english' ? 'ğŸ“' : 'ğŸ”¬';
      
      challengeData.todayQuestion = subjectEmoji + ' ' + randomChallenge.question;
      challengeData.todayAnswer = randomChallenge.answer.toLowerCase();
      challengeData.todaySubject = randomSubject;
      challengeData.lastGenerated = new Date().toDateString();
      
      localStorage.setItem('challengeData', JSON.stringify(challengeData));
    }
    
    // Submit and validate challenge answer
    function submitChallenge() {
      const userAnswer = document.getElementById('challenge-answer').value.trim().toLowerCase();
      const feedbackEl = document.getElementById('challenge-feedback');
      
      if (!userAnswer) {
        feedbackEl.innerHTML = '<span style="color: #e74c3c;">âŒ Please enter an answer!</span>';
        return;
      }
      
      // Check if answer is correct (flexible matching)
      const correctAnswer = challengeData.todayAnswer;
      const isCorrect = userAnswer === correctAnswer || 
                       userAnswer.replace(/\s+/g, '') === correctAnswer.replace(/\s+/g, '') ||
                       (correctAnswer.includes(userAnswer) && userAnswer.length > 2);
      
      if (!isCorrect) {
        feedbackEl.innerHTML = '<span style="color: #e74c3c;">âŒ Not quite right. Try again!</span>';
        return;
      }
      
      // Correct answer!
      const today = new Date().toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();
      
      // Update streak
      if (challengeData.lastCompleted === yesterday) {
        challengeData.streak++;
      } else if (challengeData.lastCompleted !== today) {
        challengeData.streak = 1;
      }
      
      // Add bonus points
      challengeData.bonusPoints += 10;
      challengeData.lastCompleted = today;
      
      localStorage.setItem('challengeData', JSON.stringify(challengeData));
      
      // Show success message
      feedbackEl.innerHTML = '<span style="color: #2ecc71;">âœ… Correct! +10 bonus points!</span>';
      
      setTimeout(() => {
        alert('ğŸ‰ Challenge completed! +10 bonus points!\nğŸ”¥ Current streak: ' + challengeData.streak + ' days');
        loadDailyChallenge();
      }, 1000);
    }
    
    // Toggle homework assistant availability
    function toggleHomeworkAssistant(enable) {
      const formElements = ['subject', 'grade', 'question', 'imageUpload'];
      const getAnswerBtn = document.querySelector('.demo-button');
      const lockedMessage = document.getElementById('challenge-locked-message');
      
      formElements.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.disabled = !enable;
      });
      
      if (getAnswerBtn) {
        getAnswerBtn.disabled = !enable;
        getAnswerBtn.style.opacity = enable ? '1' : '0.5';
        getAnswerBtn.style.cursor = enable ? 'pointer' : 'not-allowed';
      }
      
      if (lockedMessage) {
        lockedMessage.style.display = enable ? 'none' : 'block';
      }
    }
    
    // Toggle history modal
    function toggleHistory() {
      const modal = document.getElementById('history-modal');
      if (modal.style.display === 'none') {
        modal.style.display = 'block';
        displayHistory();
      } else {
        modal.style.display = 'none';
      }
    }
    
    // Filter history by subject
    function filterHistory(subject) {
      currentFilter = subject;
      
      // Update button styles
      ['all', 'math', 'english', 'science'].forEach(s => {
        const btn = document.getElementById('filter-' + s);
        if (s === subject) {
          btn.style.background = 'rgba(255, 255, 255, 0.9)';
          btn.style.color = '#667eea';
        } else {
          btn.style.background = 'rgba(255, 255, 255, 0.3)';
          btn.style.color = 'white';
        }
      });
      
      displayHistory();
    }
    
    // Display history items
    function displayHistory() {
      const historyList = document.getElementById('history-list');
      const emptyMessage = document.getElementById('empty-history');
      
      let filtered = questionHistory;
      if (currentFilter !== 'all') {
        filtered = questionHistory.filter(item => item.subject === currentFilter);
      }
      
      if (filtered.length === 0) {
        historyList.style.display = 'none';
        emptyMessage.style.display = 'block';
        return;
      }
      
      historyList.style.display = 'flex';
      emptyMessage.style.display = 'none';
      
      historyList.innerHTML = filtered.map((item, index) => {
        const subjectEmoji = item.subject === 'math' ? 'ğŸ”¢' : item.subject === 'english' ? 'ğŸ“' : 'ğŸ”¬';
        const timeAgo = getTimeAgo(item.timestamp);
        const hasImage = item.hasImage ? ' ğŸ“·' : '';
        
        return `
          <div style="background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 12px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'" onclick="expandHistoryItem(${index})">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
              <div style="font-size: 1.1em; font-weight: bold; color: #667eea;">${subjectEmoji} ${item.subject.charAt(0).toUpperCase() + item.subject.slice(1)}${hasImage}</div>
              <div style="font-size: 0.9em; color: #666;">${timeAgo}</div>
            </div>
            <div style="color: #333; font-size: 1em; margin-bottom: 8px;"><strong>Q:</strong> ${item.question.substring(0, 100)}${item.question.length > 100 ? '...' : ''}</div>
            <div id="history-answer-${index}" style="display: none; color: #555; font-size: 0.95em; margin-top: 12px; padding-top: 12px; border-top: 2px solid #e0e0e0;">
              <div style="margin-bottom: 8px;"><strong>Solution:</strong> ${item.solution}</div>
              <div style="white-space: pre-wrap;"><strong>Explanation:</strong> ${item.explanation}</div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // Expand/collapse history item
    function expandHistoryItem(index) {
      const answerDiv = document.getElementById('history-answer-' + index);
      if (answerDiv.style.display === 'none') {
        answerDiv.style.display = 'block';
      } else {
        answerDiv.style.display = 'none';
      }
    }
    
    // Calculate time ago
    function getTimeAgo(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (minutes < 1) return 'Just now';
      if (minutes < 60) return minutes + ' min ago';
      if (hours < 24) return hours + ' hour' + (hours > 1 ? 's' : '') + ' ago';
      return days + ' day' + (days > 1 ? 's' : '') + ' ago';
    }
    
    // Add question to history
    function addToHistory(subject, question, solution, explanation, hasImage) {
      questionHistory.unshift({
        subject: subject,
        question: question,
        solution: solution,
        explanation: explanation,
        timestamp: Date.now(),
        hasImage: hasImage || false
      });
      
      // Keep only last 100 questions
      if (questionHistory.length > 100) {
        questionHistory = questionHistory.slice(0, 100);
      }
      
      localStorage.setItem('questionHistory', JSON.stringify(questionHistory));
    }
    
    // Show auto sign-in notification if already signed in
    if (isSignedIn) {
      const email = localStorage.getItem('userEmail');
      setTimeout(() => {
        alert('âœ… Welcome back' + (email ? ', ' + email : '') + '! You are automatically signed in.');
      }, 500);
    }

    function showSlide(n) {
      // Safety check: ensure slides are initialized
      if (!slidesInitialized || !slides || slides.length === 0) {
        console.error('Slides not initialized!');
        initializeSlides();
        if (!slides || slides.length === 0) {
          console.error('Still no slides found!');
          return;
        }
      }
      
      // Check if trying to access slide 3 (questions) without sign-in
      if (n === 2 && !isSignedIn) {
        alert('âš ï¸ Please sign in first to ask questions!');
        return;
      }

      // Skip sign-in page if already signed in
      if (n === 1 && isSignedIn) {
        // Moving from slide 1 to 2, but already signed in - skip to slide 3
        if (currentSlide === 0) {
          n = 2;
        }
      }

      slides[currentSlide].classList.remove('active');
      
      // Stop timer if leaving slide 3
      if (currentSlide === 2) {
        stopStudySession();
      }
      
      currentSlide = (n + totalSlides) % totalSlides;
      slides[currentSlide].classList.add('active');
      document.getElementById('currentSlide').textContent = currentSlide + 1;
      
      // Start timer if entering slide 3
      if (currentSlide === 2) {
        startStudySession();
      }
      
      // Update progress bar
      const progress = ((currentSlide + 1) / totalSlides) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
    }

    function nextSlide() {
      showSlide(currentSlide + 1);
    }

    function previousSlide() {
      showSlide(currentSlide - 1);
    }

    // Arrow keys only navigation
    document.addEventListener('keydown', (e) => {
      // Check if user is typing in an input field
      const isTyping = document.activeElement.tagName === 'INPUT' || 
                       document.activeElement.tagName === 'TEXTAREA' ||
                       document.activeElement.tagName === 'SELECT';
      
      if (e.key === 'ArrowRight') {
        nextSlide();
      } else if (e.key === 'ArrowLeft') {
        previousSlide();
      } else if (e.key === 'Enter' && !isTyping) {
        // Enter key moves to next slide when not typing
        nextSlide();
      }
    });

    // Sign up button functionality
    function handleSignUp() {
      const email = document.querySelector('input[type="email"]').value;
      const password = document.getElementById('password-field').value;
      
      if (email && password) {
        isSignedIn = true;
        // Save to localStorage for auto sign-in
        localStorage.setItem('isSignedIn', 'true');
        localStorage.setItem('userEmail', email);
        alert('âœ… Sign up successful! You can now access the questions page.');
        nextSlide(); // Move to next slide
      } else {
        alert('Please fill in email and password');
      }
    }

    // Password visibility toggle
    function togglePassword() {
      const passwordField = document.getElementById('password-field');
      const icon = event.target;
      
      if (passwordField.type === 'password') {
        passwordField.type = 'text';
        icon.textContent = 'ğŸ™ˆ';
      } else {
        passwordField.type = 'password';
        icon.textContent = 'ğŸ‘ï¸';
      }
    }

    // Subject examples
    const subjectExamples = {
      'math': 'Example: What is 2x + 5 = 13?',
      'english': 'Example: What is an adverb?',
      'science': 'Example: What is Newton\'s first law?'
    };

    // Store uploaded image
    let uploadedImage = null;

    // Handle image upload
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      // Show preview
      const reader = new FileReader();
      reader.onload = function(e) {
        const previewDiv = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const imageName = document.getElementById('imageName');
        
        previewImg.src = e.target.result;
        imageName.textContent = file.name;
        previewDiv.style.display = 'block';
        
        // Store for submission
        uploadedImage = {
          name: file.name,
          data: e.target.result.split(',')[1], // Base64 data without prefix
          mimeType: file.type
        };
      };
      reader.readAsDataURL(file);
    }

    // Update example when subject changes
    function updateExample() {
      const subject = document.getElementById('subject').value;
      const questionField = document.getElementById('question');
      const mathKeyboard = document.getElementById('math-keyboard');
      
      if (subject && subjectExamples[subject]) {
        questionField.placeholder = subjectExamples[subject];
      } else {
        questionField.placeholder = 'Type your question here...';
      }
      
      // Show math keyboard for math subject
      if (mathKeyboard) {
        mathKeyboard.style.display = subject === 'math' ? 'block' : 'none';
      }
    }

    // Get Answer function
    let isProcessing = false; // Prevent multiple submissions
    let lastQuestion = ''; // Track last question to prevent duplicates

    async function getAnswer() {
      const subject = document.getElementById('subject').value;
      const grade = document.getElementById('grade').value;
      const question = document.getElementById('question').value;
      const answerSection = document.getElementById('answer-section');
      const solutionEl = document.getElementById('solution');
      const explanationEl = document.getElementById('explanation');
      
      // Prevent multiple clicks while processing
      if (isProcessing) {
        return;
      }
      
      // Validate subject selection
      if (!subject) {
        alert('âš ï¸ Please select a subject first!');
        return;
      }

      // Check if we have either text question or image
      if (!question.trim() && !uploadedImage) {
        alert('Please enter a question or upload an image');
        return;
      }

      // Set processing flag
      isProcessing = true;

      // Show loading animation
      showLoading();
      answerSection.style.display = 'block';
      solutionEl.innerHTML = '';
      explanationEl.textContent = '';

      try {
        let endpoint = '/api/solve';
        let requestBody;
        let requestOptions = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        };

        // If image is uploaded, use image endpoint
        if (uploadedImage) {
          endpoint = '/api/solve-image';
          requestBody = JSON.stringify({
            subject: subject,
            grade: grade,
            image: uploadedImage.data,
            mimeType: uploadedImage.mimeType,
            question: question || '' // Optional additional context
          });
        } else {
          // Text question only
          requestBody = JSON.stringify({
            subject: subject,
            grade: grade,
            problem: question
          });
        }

        requestOptions.body = requestBody;
        const response = await fetch(endpoint, requestOptions);

        const data = await response.json();

        // Hide loading animation
        hideLoading();

        if (data.success) {
          // Display results immediately
          solutionEl.textContent = data.data.solution;
          explanationEl.textContent = data.data.explanation;
          
          // Only update stats if this is a NEW question (not duplicate click)
          const currentQuestion = question + subject + (uploadedImage ? 'img' : '');
          if (currentQuestion !== lastQuestion) {
            updateStats(subject);
            addToHistory(subject, question || 'Image question', data.data.solution, data.data.explanation, !!uploadedImage);
            lastQuestion = currentQuestion;
          }
        } else {
          solutionEl.textContent = 'âŒ Error';
          explanationEl.textContent = data.error || 'Failed to get answer';
        }
      } catch (error) {
        hideLoading();
        solutionEl.textContent = 'âŒ Connection Error';
        explanationEl.textContent = 'Could not connect to server. Make sure the server is running.';
        console.error(error);
      } finally {
        // Reset processing flag
        isProcessing = false;
      }
    }
  </script>
</body>
</html>
